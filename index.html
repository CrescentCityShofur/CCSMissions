<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescent City Shofur | CCS Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBw-x8f7_2Z9m-H3k1Lq5p6o7n8m9l0k&libraries=places&callback=initMap" async defer></script>
    <style>
        :root { --gold: #fcf6ba; }
        body { 
            font-family: 'Montserrat', sans-serif; background-color: #0a0118;
            background-image: linear-gradient(rgba(10,1,24,0.96), rgba(15,5,30,0.98)), url('https://raw.githubusercontent.com/CrescentCityShofur/Shofur.Nola/main/nola.png');
            background-size: cover; background-position: center; background-attachment: fixed; color: #ffffff; 
        }
        .gold-shimmer {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shimmer 5s infinite linear; background-size: 200% auto;
        }
        @keyframes shimmer { to { background-position: 200% center; } }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(252, 246, 186, 0.1); border-radius: 30px; }
        .input-field { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.15); color: white !important; border-radius: 8px; outline: none; padding: 1rem; width: 100%; text-transform: uppercase; font-size: 0.75rem; tracking: 0.1em; }
        #map { height: 220px; border-radius: 12px; border: 1px solid rgba(252, 246, 186, 0.3); margin-top: 12px; }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen py-20 px-6 text-center">
    <header class="mb-16">
        <h1 style="font-family: 'Cinzel', serif;" class="text-4xl md:text-6xl gold-shimmer uppercase tracking-widest leading-none">Crescent City Shofur</h1>
        <p class="text-[14px] text-white uppercase tracking-[0.4em] mt-6 font-semibold italic">Coastal Consolidated Solutions</p>
    </header>

    <div class="w-full max-w-md glass-panel p-8">
        <div id="commandCenter" class="space-y-6 text-left">
            <input type="email" id="stakeholderEmail" placeholder="STAKEHOLDER EMAIL" class="input-field">
            <input type="text" id="pickup" placeholder="PICKUP LOCATION" class="input-field">
            <input type="text" id="dropoff" placeholder="DESTINATION" class="input-field">
            <div id="map"></div>
            <div class="mt-6 text-center">
                <p id="priceOutput" class="text-5xl gold-shimmer font-light">$0.00</p>
                <p id="priceDesc" class="text-[10px] text-gray-400 mt-2 uppercase tracking-widest">Awaiting Logistics...</p>
            </div>
            <button onclick="dispatchMission()" id="authorizeBtn" disabled class="w-full bg-gray-800 text-gray-500 py-6 text-xs font-black uppercase tracking-[0.5em] rounded-lg transition-all">
                Authorize Mission
            </button>
        </div>
    </div>

    <script>
        const stripe = Stripe('pk_live_51Sub4u00aruvjmQ2mvXyX7v3YFY11LEMViffvxVJ4rYQ03MyatLbE640LKBAZZnrji9z6RKB4irBb0MTdpTRrcXmW00Lhx0XJ2v');
        let map, directionsService, directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), { center: { lat: 29.9511, lng: -90.0715 }, zoom: 11, styles: [{stylers:[{saturation:-100}]}] });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({ map, polylineOptions: { strokeColor: "#fcf6ba", strokeWeight: 4 } });
            const acOptions = { componentRestrictions: { country: 'us' } };
            new google.maps.places.Autocomplete(document.getElementById('pickup'), acOptions).addListener('place_changed', updateLogistics);
            new google.maps.places.Autocomplete(document.getElementById('dropoff'), acOptions).addListener('place_changed', updateLogistics);
        }

        async function updateLogistics() {
            const p = document.getElementById('pickup').value;
            const d = document.getElementById('dropoff').value;
            if (!p || !d) return;

            const res = await fetch(`/api/price?origin=${encodeURIComponent(p)}&destination=${encodeURIComponent(d)}`);
            const data = await res.json();
            
            if (data.total) {
                document.getElementById('priceOutput').innerText = `$${data.total}`;
                document.getElementById('priceDesc').innerText = "10% REGIONAL GROWTH FUND INCLUDED";
                const btn = document.getElementById('authorizeBtn');
                btn.disabled = false; btn.classList.replace('bg-gray-800', 'bg-[#fcf6ba]'); btn.classList.replace('text-gray-500', 'text-black');
                directionsService.route({ origin: p, destination: d, travelMode: 'DRIVING' }, (r, s) => { if (s === 'OK') directionsRenderer.setDirections(r); });
            }
        }

        async function dispatchMission() {
            const amt = Math.round(parseFloat(document.getElementById('priceOutput').innerText.replace('$', '')) * 100);
            const { error } = await stripe.redirectToCheckout({
                lineItems: [{ price_data: { currency: 'usd', product_data: { name: 'CCS MISSION AUTHORIZATION' }, unit_amount: amt }, quantity: 1 }],
                mode: 'payment', successUrl: window.location.origin + '?success=true', cancelUrl: window.location.origin,
                customerEmail: document.getElementById('stakeholderEmail').value
            });
        }
    </script>
</body>
</html>
