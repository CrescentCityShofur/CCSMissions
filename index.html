<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescent City Shofur | CCS Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaPRyrkFfUOmhQktzRS6rd1jMrGMnuzgI&libraries=places&callback=initMap" async defer></script>
    <script src="https://js.stripe.com/v3/"></script>

    <style>
        :root { --gold: #fcf6ba; }
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #0a0118;
            background-image: linear-gradient(rgba(10,1,24,0.96), rgba(15,5,30,0.98)), 
                              url('https://raw.githubusercontent.com/CrescentCityShofur/Shofur.Nola/main/nola.png');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #ffffff; 
        }
        .gold-shimmer {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shimmer 5s infinite linear; background-size: 200% auto;
        }
        @keyframes shimmer { to { background-position: 200% center; } }
        .glass-panel { 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(252, 246, 186, 0.1); 
            border-radius: 30px; 
        }
        .input-field {
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
            color: #ffffff !important; border-radius: 0; outline: none; transition: all 0.3s ease;
            appearance: none; -webkit-appearance: none;
        }
        input[type="date"], input[type="time"] { color-scheme: dark; color: white !important; }
        .input-field:focus { border-color: var(--gold); background: rgba(255,255,255,0.08); }
        #map { height: 250px; border-radius: 12px; border: 1px solid rgba(252, 246, 186, 0.3); margin-top: 12px; }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen py-20 px-6 text-center">

    <header id="mainHeader" class="mb-16 w-full max-w-4xl">
        <p class="text-[12px] text-gray-400 uppercase tracking-[1em] mb-4">Coastal Consolidated Solutions</p>
        <h1 style="font-family: 'Cinzel', serif;" class="text-4xl md:text-7xl gold-shimmer uppercase tracking-widest leading-none">Crescent City Shofur</h1>
        <p class="text-xl md:text-2xl font-light text-white lowercase tracking-[0.5em] mt-2">fueling</p>
    </header>

    <div id="infoPanels" class="w-full max-w-2xl space-y-6 mb-12 text-left">
        <div class="glass-panel p-8 border-l-4 border-l-[#fcf6ba]">
            <h3 class="text-[10px] text-[#fcf6ba] uppercase tracking-widest mb-4 font-bold underline">Mission Stewardship</h3>
            <p class="text-[11px] leading-relaxed text-gray-300">Pricing is calculated via our Regional Corridor Math: Base + Distance + Time. All missions contribute 10% to the Regional Growth Fund for infrastructure stewardship. Missions occurring after 22:00 incur a flat $10 Night-Ops surcharge.</p>
        </div>
        <div class="glass-panel p-8">
            <h3 class="text-[10px] text-[#fcf6ba] uppercase tracking-widest mb-4 font-bold">Founderâ€™s Note</h3>
            <p class="text-sm font-light leading-relaxed text-gray-300 italic">"We operate at the intersection of logistics and legacy. Every transaction should leave our infrastructure stronger than we found it."</p>
        </div>
    </div>

    <div class="w-full max-w-md">
        <button onclick="revealCommand()" id="fuelBtn" class="w-full border-2 border-[#fcf6ba] py-6 px-10 text-[#fcf6ba] uppercase text-xs tracking-[0.5em] font-bold hover:bg-[#fcf6ba] hover:text-black transition-all duration-700">
            Fuel the Mission
        </button>

        <div id="commandCenter" class="hidden mt-12 space-y-4 text-left">
            <h2 class="text-[#fcf6ba] text-[10px] uppercase tracking-widest font-bold mb-6 border-b border-[#fcf6ba]/20 pb-2">Mission Authorization</h2>
            
            <input type="text" id="stakeholderName" placeholder="STAKEHOLDER NAME" class="input-field w-full p-4 text-xs tracking-widest uppercase">
            
            <div class="flex flex-col md:flex-row gap-4">
                <input type="email" id="stakeholderEmail" placeholder="EMAIL ADDRESS" class="input-field flex-1 p-4 text-xs tracking-widest">
                <input type="tel" id="stakeholderPhone" placeholder="PHONE NUMBER" class="input-field flex-1 p-4 text-xs tracking-widest">
            </div>
            
            <select id="bridgeType" onchange="updateMarkers()" class="input-field w-full p-4 text-xs tracking-widest bg-[#0a0118]">
                <option value="local">Local Bridge ($15 Min)</option>
                <option value="charter">Charter ($65/hr - 2hr Min Deposit)</option>
                <option value="tour">Tour Bridge (30+ Miles / Corridor)</option>
            </select>

            <input type="text" id="pickup" placeholder="PICKUP LOCATION" class="input-field w-full p-4 text-xs tracking-widest uppercase">
            <input type="text" id="dropoff" placeholder="DESTINATION" class="input-field w-full p-4 text-xs tracking-widest uppercase">
            
            <div id="map"></div>

            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="text-[9px] text-[#fcf6ba] uppercase tracking-widest ml-1">Date</label>
                    <input type="date" id="date" class="input-field w-full p-4 text-xs">
                </div>
                <div class="flex-1">
                    <label class="text-[9px] text-[#fcf6ba] uppercase tracking-widest ml-1">Time</label>
                    <input type="time" id="time" class="input-field w-full p-4 text-xs">
                </div>
            </div>

            <div id="priceSection" class="mt-6 text-center py-4 border-t border-white/10">
                <p id="priceOutput" class="text-5xl gold-shimmer font-light">$0.00</p>
                <p id="priceDesc" class="text-[10px] text-gray-400 mt-2 uppercase tracking-widest italic">Awaiting Logistics Data...</p>
            </div>

            <button onclick="dispatchMission()" class="w-full bg-[#fcf6ba] text-black py-6 text-xs font-black uppercase tracking-[0.5em] mt-8 hover:bg-white transition-all duration-300 shadow-[0_0_20px_rgba(252,246,186,0.2)]">
                Authorize Mission
            </button>
        </div>
    </div>

    <script>
        const stripe = Stripe('pk_live_51Sub4u00aruvjmQ2mvXyX7v3YFY11LEMViffvxVJ4rYQ03MyatLbE640LKBAZZnrji9z6RKB4irBb0MTdpTRrcXmW00Lhx0XJ2v');
        let map, directionsService, directionsRenderer, autocompletePickup, autocompleteDropoff;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 29.9511, lng: -90.0715 }, zoom: 11,
                styles: [{featureType:"all",stylers:[{saturation:-100},{lightness: -50}]}]
            });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                polylineOptions: { strokeColor: "#fcf6ba", strokeWeight: 4 }
            });
            
            autocompletePickup = new google.maps.places.Autocomplete(document.getElementById('pickup'));
            autocompleteDropoff = new google.maps.places.Autocomplete(document.getElementById('dropoff'));
            autocompletePickup.addListener('place_changed', updateMarkers);
            autocompleteDropoff.addListener('place_changed', updateMarkers);
        }

        function updateMarkers() {
            const pickupVal = document.getElementById('pickup').value;
            const dropoffVal = document.getElementById('dropoff').value;
            const bridge = document.getElementById('bridgeType').value;

            if (pickupVal && dropoffVal) {
                directionsService.route({
                    origin: pickupVal,
                    destination: dropoffVal,
                    travelMode: 'DRIVING'
                }, (result, status) => {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(result);
                        const leg = result.routes[0].legs[0];
                        const mi = leg.distance.value / 1609.34;
                        const min = leg.duration.value / 60;
                        let subtotal = 0;

                        // Airport Logic
                        const isToMSY = dropoffVal.toUpperCase().includes("MSY") || dropoffVal.toUpperCase().includes("LOUIS ARMSTRONG");
                        const isFromMSY = pickupVal.toUpperCase().includes("MSY") || pickupVal.toUpperCase().includes("LOUIS ARMSTRONG");

                        if (isToMSY) subtotal = 45;
                        else if (isFromMSY) subtotal = 65;
                        else if (bridge === 'charter') subtotal = 130;
                        else if (bridge === 'tour' || mi > 30) subtotal = (mi * 1.31) + (min * 1.42);
                        else {
                            subtotal = 7 + (mi * 1.30) + (min * 0.50);
                            if (subtotal < 15) subtotal = 15;
                        }

                        const hour = new Date().getHours();
                        const nightFee = (hour >= 22 || hour < 5) ? 10 : 0;
                        const finalTotal = (subtotal * 1.10) + nightFee;

                        document.getElementById('priceOutput').innerText = '$' + finalTotal.toFixed(2);
                        document.getElementById('priceDesc').innerText = `MILEAGE: ${mi.toFixed(1)} | INCL. 10% GROWTH FUND`;
                    }
                });
            }
        }

        function revealCommand() {
            document.getElementById('commandCenter').classList.remove('hidden');
            document.getElementById('fuelBtn').style.display = 'none';
        }

        function dispatchMission() {
            const name = document.getElementById('stakeholderName').value;
            const amountDisplay = document.getElementById('priceOutput').innerText;
            const amountCent = Math.round(parseFloat(amountDisplay.replace('$', '')) * 100);

            // System Check Alert to help diagnose mobile silence
            alert("CCS SYSTEM CHECK: Initializing secure bridge for $" + amountDisplay);

            if (!name || amountCent === 0) { 
                alert("Logistics Error: Define locations and date to calculate fuel requirements."); 
                return; 
            }

            stripe.redirectToCheckout({
                lineItems: [{ 
                    price_data: { 
                        currency: 'usd', 
                        product_data: { name: 'CCS MISSION AUTHORIZATION: ' + name.toUpperCase() }, 
                        unit_amount: amountCent 
                    }, 
                    quantity: 1 
                }],
                mode: 'payment',
                successUrl: window.location.origin + window.location.pathname + `?success=true&name=${encodeURIComponent(name)}`,
                cancelUrl: window.location.origin + window.location.pathname,
            }).then(result => {
                if (result.error) alert(result.error.message);
            });
        }
    </script>
</body>
</html>
