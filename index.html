<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescent City Shofur | CCS Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBw-x8f7_2Z9m-H3k1Lq5p6o7n8m9l0k&libraries=places&callback=initMap" async defer></script>
    <style>
        body { 
            font-family: 'Montserrat', sans-serif; background-color: #0a0118; color: white;
            background-image: linear-gradient(rgba(10,1,24,0.9), rgba(10,1,24,0.9)), url('nola.png');
            background-size: cover; background-attachment: fixed;
        }
        .gold-shimmer {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shimmer 5s infinite linear; background-size: 200% auto;
        }
        @keyframes shimmer { to { background-position: 200% center; } }
        .glass-panel { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(252, 246, 186, 0.2); border-radius: 20px; }
        .input-field { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 1rem; border-radius: 10px; width: 100%; outline: none; }
        #map { height: 200px; border-radius: 15px; margin: 1.5rem 0; border: 1px solid #fcf6ba; }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen py-10 px-6">
    <header class="text-center mb-10">
        <h1 style="font-family: 'Cinzel', serif;" class="text-4xl gold-shimmer uppercase tracking-widest">Crescent City Shofur</h1>
        <p class="text-xs tracking-[0.3em] mt-2 font-semibold">COASTAL CONSOLIDATED SOLUTIONS</p>
    </header>

    <main class="w-full max-w-md glass-panel p-8 space-y-4">
        <h2 class="text-[#fcf6ba] text-xs uppercase tracking-widest text-center border-b border-[#fcf6ba]/20 pb-4">Mission Logistics Hub</h2>
        
        <input type="text" id="stakeholderName" placeholder="STAKEHOLDER NAME" class="input-field uppercase text-xs">
        <input type="email" id="stakeholderEmail" placeholder="EMAIL ADDRESS" class="input-field text-xs">
        <input type="tel" id="stakeholderPhone" placeholder="PHONE NUMBER" class="input-field text-xs">

        <select id="bridgeType" onchange="updateLogistics()" class="input-field text-xs bg-[#0a0118]">
            <option value="local">Local Bridge</option>
            <option value="charter">Charter Bridge ($130 Deposit)</option>
            <option value="tour">Tour Bridge</option>
        </select>

        <input type="text" id="pickup" placeholder="PICKUP LOCATION" class="input-field uppercase text-xs">
        <input type="text" id="dropoff" placeholder="DESTINATION" class="input-field uppercase text-xs">

        <div id="map"></div>

        <div class="flex gap-2">
            <input type="date" id="date" onchange="updateLogistics()" class="input-field text-xs">
            <input type="time" id="time" onchange="updateLogistics()" class="input-field text-xs">
        </div>

        <div class="text-center py-6">
            <p id="priceOutput" class="text-5xl gold-shimmer font-light">$0.00</p>
            <p class="text-[9px] text-gray-400 mt-2 tracking-widest">10% REGIONAL GROWTH FUND INCLUDED</p>
        </div>

        <button onclick="dispatchMission()" id="authorizeBtn" disabled class="w-full bg-gray-800 text-gray-500 py-5 rounded-lg font-bold uppercase tracking-widest transition-all">
            Authorize Mission
        </button>
    </main>

    <script>
        const stripe = Stripe('pk_live_51Sub4u00aruvjmQ2mvXyX7v3YFY11LEMViffvxVJ4rYQ03MyatLbE640LKBAZZnrji9z6RKB4irBb0MTdpTRrcXmW00Lhx0XJ2v');
        let map, directionsService, directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), { center: { lat: 29.9511, lng: -90.0715 }, zoom: 12, styles: [{stylers:[{saturation:-100}]}] });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({ map, polylineOptions: { strokeColor: "#fcf6ba", strokeWeight: 4 } });
            
            new google.maps.places.Autocomplete(document.getElementById('pickup')).addListener('place_changed', updateLogistics);
            new google.maps.places.Autocomplete(document.getElementById('dropoff')).addListener('place_changed', updateLogistics);
        }

        async function updateLogistics() {
            const p = document.getElementById('pickup').value;
            const d = document.getElementById('dropoff').value;
            const b = document.getElementById('bridgeType').value;
            const t = document.getElementById('time').value;
            if (!p || !d || !t) return;

            const res = await fetch('/api/price', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pickup: p, dropoff: d, bridgeType: b, time: t })
            });
            const data = await res.json();
            
            if (data.price) {
                document.getElementById('priceOutput').innerText = `$${data.price}`;
                const btn = document.getElementById('authorizeBtn');
                btn.disabled = false; btn.style.backgroundColor = '#fcf6ba'; btn.style.color = '#000';
                directionsService.route({ origin: p, destination: d, travelMode: 'DRIVING' }, (r, s) => { if (s === 'OK') directionsRenderer.setDirections(r); });
            }
        }

        function dispatchMission() {
            const amt = Math.round(parseFloat(document.getElementById('priceOutput').innerText.replace('$', '')) * 100);
            stripe.redirectToCheckout({
                lineItems: [{ price_data: { currency: 'usd', product_data: { name: 'CCS MISSION' }, unit_amount: amt }, quantity: 1 }],
                mode: 'payment', successUrl: window.location.origin, cancelUrl: window.location.origin,
                customerEmail: document.getElementById('stakeholderEmail').value
            });
        }
    </script>
</body>
</html>
